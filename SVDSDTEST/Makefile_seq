# include the environment, compilation, and linking flags

include ../Make_flags
include ../Link_flags

#------------------------------------------------

FSOURCE = ilut.f amux.f atmux.f atmuxr.f

FOBJS = ilut.o amux.o atmux.o atmuxr.o

CSOURCE = driver_seq.c readuc.c shared_utils.c ssrcsr.c mmio.c 
 
COBJS = driver_seq.o readuc.o shared_utils.o ssrcsr.o mmio.o

DRIVEROBJECTS = $(COBJS) $(FOBJS)

.PHONY: clean veryclean

seq_dprimme_svds: $(COBJS) svdsddependencies_seq $(TOP)/libprimme.a
	$(CLDR) -o seq_dprimme_svds $(DRIVEROBJECTS) $(LIBDIRS) $(INCLUDE) $(SVDSINCLUDE) $(LIBS) $(LDFLAGS) 

driver_seq.o: driver_seq.c
	$(CC) $(LOW_OPT) $(CFLAGS) $(DEFINES) $(INCLUDE) $(SVDSINCLUDE) -c driver_seq.c

readuc.o: readuc.c
	$(CC) $(LOW_OPT) $(CFLAGS) $(DEFINES) $(INCLUDE) $(SVDSINCLUDE) -c readuc.c

shared_utils.o: shared_utils.c
	$(CC) $(LOW_OPT) $(CFLAGS) $(DEFINES) $(INCLUDE) $(SVDSINCLUDE) -c shared_utils.c

ssrcsr.o: ssrcsr.c
	$(CC) $(LOW_OPT) $(CFLAGS) $(DEFINES) $(INCLUDE) $(SVDSINCLUDE) -c ssrcsr.c

mmio.o: mmio.c
	$(CC) $(LOW_OPT) $(CFLAGS) $(DEFINES) $(INCLUDE) $(SVDSINCLUDE) -c mmio.c

ilut.o: ilut.f
	$(F77) $(HIGH_OPT) $(FFLAGS) -c ilut.f

amux.o: amux.f
	$(F77) $(HIGH_OPT) $(FFLAGS) -c amux.f

atmux.o: atmux.f
	$(F77) $(HIGH_OPT) $(FFLAGS) -c atmux.f

atmuxr.o: atmuxr.f
	$(F77) $(HIGH_OPT) $(FFLAGS) -c atmuxr.f

clean:
	- rm -f *.o

veryclean:
	- rm -f seq_dprimme_svds *.o core

svdsddependencies_seq:
	gcc -MM $(INCLUDE) $(SVDSINCLUDE) $(CSOURCE) > svdsddependencies_seq

all: seq_dprimme_svds
seq_dprimme_svds: $(DRIVEROBJECTS)
include svdsddependencies_seq
